---
title: "Model Replication"
author: "Kyle Rohde, Caroline Devlin"
date: "9/10/2021"
output:
  html_document: default
  pdf_document: default
<<<<<<< Updated upstream
=======
  word_document: default
>>>>>>> Stashed changes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Model Replication

The purpose of this document is to replicate "The Impact of Covid-19 Testing on College Campuses" research done by Zhuoting Yu, Akane B. Fujimoto, Pinar Keskinocak, and Julie Swann.

The model created considers various states to describe a student's status as it relates to Covid-19 infection. The states are as follows:

$S$: susceptible

$I_a$: infected and asymptomatic

$I_s$: infected and symptomatic

$TFN_{a(s)}$: infected and asymptomatic (symptomatic), has been tested with false negative results

$TISO^+_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently in isolation

$TISO^-_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently not in isolation

$RC$: recovered and confirmed, i.e., has been diagnosed previously

$RU$: recovered and unknown, i.e., has not been diagnosed previously

The follow equations describe the fraction of individuals in each state over time

$$
\dot{S} = -\beta_aS(I_a + TFN_a + TISO_a^-)-\beta_sS(I_s+TFN_s+TISO_s^-)
$$

$$
\dot{I_a}= (1-p_0) \times [\beta_aS(I_a+TFN_a+TISO_a^-)+\beta_sS(I_s+TFN_s+TISO_s^-)]-T_{pcr} \times I_a-T{rap} \times I_a -\gamma_aI_a
$$

$$
\dot{I_s} = p_0 \times [\beta_aS(I_a+TFN_a+TISO_a^-)+\beta_sS(I_s+TFN_s+TISO_s^-)] − T_{pcr} × I_s − T_{rap} × I_s − γ_sI_s
$$

$$
\dot{TFN_a} =T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a − γ_a × TFN_a
$$

$$
\dot{TFN_s} =T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s − γ_s × TFN_s
$$

$$
\dot{TISO^+_a} =C_a × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^+_a
$$

$$
\dot{TISO^+_s} =C_s × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^+_s
$$

$$
\dot{TISO^−_a} =(1 − C_a) × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^−_a
$$

$$
\dot{TISO^−_s} =(1 − C_s) × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^−_s
$$

Below are the variable definitions

|          Parameter         |                                             Description                                             |           Value          |
|:--------------------------:|:---------------------------------------------------------------------------------------------------:|:------------------------:|
|     $\beta_a$,$\beta_s$    | Transmission rate due to contact between susceptible and asymptomatic/symptomatic infected subjects |          0.1,0.2         |
|          $\gamma$          |                              Rate of recovery of an infected individual                             |            0.1           |
|            $p_0$           |                            Proportion of infections that are symptomatic                            |            0.5           |
|         $C_a$,$C_s$        |        Isolation compliance rate for asymptomatic/symptomatic infected and tested individuals       |         0.7, 0.9         |
|  $FN_{pcr_a}$,$FN_{pcr_s}$ |               False negative rate of a PCR test for asymptomatic/symptomatic patients               |         15%, 15%         |
| $FN_{rap_a}$, $FN_{rap_s}$ |              False negative rate of a rapid test for asymptomatic/symptomatic patients              |         30%, 30%         |
| $FP_{pcr_a}$, $FP_{pcr_s}$ |               False positive rate of a PCR test for asymptomatic/symptomatic patients               |          5%, 5%          |
| $FP_{rap_a}$, $FP_{rap_s}$ |               False positive ate of a rapid test for asymptomatic/symptomatic patients              |         10%, 10%         |
|          $T_{pcr}$         |                         Percentage of students that have access to PCR tests                        | Defined in each scenario |
|  $T_{rap_a}$, $T_{rap_s}$  |                    Percentage of students that have access to rapid antigen tests                   | Defined in each scenario

```{r}
library("readxl")

# load dataset & remove unecessary columns
data <- read_excel("enrollment.xlsx")
attach(data)

data <- subset(data, DETAIL_LVL_DESC!="District" & DETAIL_LVL_DESC!="State")
data <- subset(data, select = -c(LONG_SCHOOL_YEAR, 
                                 ENVIRONMENT,
                                 INSTN_NUMBER,
                                 GRADES_SERVED_DESC,
                                 ENROLLMENT_PERIOD,
                                 GRADE_LEVEL,
                                 ENROLLMENT_COUNT,
                                 DETAIL_LVL_DESC))
```

```{r}
library(hash)

generate_school_population <- function() {
  school_population <- hash()
  school_population["K"]     <- 0
  school_population["1"]     <- 0
  school_population["2"]     <- 0
  school_population["3"]     <- 0
  school_population["4"]     <- 0
  school_population["5"]     <- 0
  school_population["6"]     <- 0
  school_population["7"]     <- 0
  school_population["8"]     <- 0
  school_population["9"]     <- 0
  school_population["10"]    <- 0
  school_population["11"]    <- 0
  school_population["12"]    <- 0
  school_population["staff"] <- 0 # should include faculty
  return(school_population)
}

generate_default_school <- function() {
  school <- hash()
  school["population"]       <- generate_school_population()
  school["environment_type"] <- "Urban"
  school["days"]             <- 107
  school["mask_compliance"]  <- 0
  school["vaccinations"]     <- 0
  school["rap_testing"]      <- 0
  school["pcr_testing"]      <- 0
  return(school)
}

get_unique_districts <- function(data) {
  districts <- c(data$SCHOOL_DSTRCT_CD)
  return(unique(districts))
}

populate_schools <- function(data) {
  schools <- hash()
  for (i in 1:nrow(data)) {
    school_name <- data[i, 3]
    if (has.key(school_name, schools)) {
      next
    }
    schools[school_name] <- generate_default_school()
  }
  return(schools)
}

schools <- populate_schools(data)
```

Below is the R code for defining the initial values and constants of the system.

```{r}
# Initial states
b_a = 0.1       # transmission rate due to contact of asymptomatic patient
b_s = 0.2       # transmission rate due to contact of symptomatic patient
gamma = 0.1     # rate of recovery for an infected individual
p0 = 0.5        # proportion of infections that are symptomatic
c_a = 0.7       # isolation compliance asymptomatic infected + tested patients
c_s = 0.9       # isolation compliance symptomatic infected + tested patients
FNpcr_a = 0.15  # false negative rate of a PCR test for asymptomatic patients
FNpcr_s = 0.15  # false negative rate of a PCR test for symptomatic patients
FNrap_a = 0.30  # false negative rate of a rapid test for asymptomatic patients
FNrap_s = 0.30  # false negative rate of a rapid test for symptomatic patients
FPpcr_a = 0.05  # false positive rate of a PCR test for asymptomatic patients
FPpcr_s = 0.05  # false positive rate of a PCR test for symptomatic patients
FPrap_a = 0.10  # false positive rate of a rapid test for asymptomatic patients
FPrap_s = 0.10  # false positive rate of a rapid test for symptomatic patients

# Initial values
S_0 = 0.895     # initial susceptibility of the student body
I_s = 0.0025    # initial infected and symptomatic
I_a = 0.0025    # initial infected and asymptomatic
R_u = 0.10      # initial recovered unknown
R_c = 0.0       # initial recovered confirmed

# Initial test values (no tests administered)
TFN_a = 0       # initial population with a false negative and asymptomatic
TFN_s = 0       # initial population with a false negative and symptomatic 
TISO_an = 0     # initial population tested with infection, not in isolation, asymptomatic 
TISO_ap = 0     # initial population tested with infection, in isolation, asymptomatic 
TISO_sn = 0     # initial population tested with infection, not in isolation, symptomatic
TISO_sp = 0     # initial population tested with infection, in isolation, symptomatic

n = 15000       # student population

# Days in simulation
days <- 107

# Sequence for semester
semester <- seq(1, days, by=1)

# Initial state of the system
initial_state <- c(S_0 = S_0, I_a = I_a, I_s = I_s, TFN_a = TFN_a, TFN_s = TFN_s, TISO_an = TISO_an, TISO_sn = TISO_sn, TISO_ap = TISO_ap, TISO_sp = TISO_sp, RC = R_c, RU = R_u)
```

The following code defines the differential equations for the change in the states over time. The functions allow the user to input current values for the states and returns the derivative at that time step. 

```{r}
S_dot <- function(b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn) {
  result <- (-b_a * S_0 * (I_a + TFN_a + TISO_an)) - (b_s * S_0 * (I_s + TFN_s + TISO_sn))
  return(result)
}

I_a_dot <- function(p0, b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- (1 - p0) * ((b_a * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_a) - (T_rap * I_a) - (gamma * I_a)
  return(result)
}

I_s_dot <- function(p0, b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- p0 * ((b_a * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_s) - (T_rap * I_s) - (gamma * I_s)
  return(result)
}

TFN_a_dot <- function(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a) {
  result <- (T_pcr * FNpcr_a * I_a) + (T_rap * FNrap_a * I_a) - (gamma * TFN_a)
  return(result)
}

TFN_s_dot <- function(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s) {
  result <- (T_pcr * FNpcr_s * I_s) + (T_rap * FNrap_s * I_s) - (gamma * TFN_s)
  return(result)
}

TISO_ap_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap) {
  result <- c_a * ((T_pcr * (1 -FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_ap)
  return(result)
}

TISO_sp_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp) {
  result <- c_s * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sp)
  return(result)
}

TISO_an_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an) {
  result <- (1 - c_a) * ((T_pcr * (1 - FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_an)
  return(result)
}

TISO_sn_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn) {
  result <- (1 - c_s) * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sn)
  return(result)
}

RC_dot <- function(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn) {
  result <- gamma * (TISO_ap + TISO_sp + TISO_an + TISO_sn)
  return(result)
}

RU_dot <- function(gamma, I_a, I_s, TFN_a, TFN_s) {
  result <- gamma * (I_a + I_s + TFN_a + TFN_s)
  return(result)
}
```

Now that the system's equations have been defined, we define functions to observe the changes in the system. These functions include all of the state derivative equations as well as a function that loops through the days, solving the differential of all equations for each day of the semester. The function `run_simulation` takes 

* `state`: The initial state of the system,
* `testing`: The parameters for a day in which testing occurs
* `no_testing`: The parameters for a day in which no testing occurs
* `semester`: A time sequence representing the simulation semester

and returns a list containing the values of each state for each day. 

```{r, results='hide'}
library(deSolve)
library(scatterplot3d)
library(lubridate)
```

```{r}
# Define generic differential update function
differentials <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    dS <- S_dot(b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn)
    dI_a <- I_a_dot(p0, b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dI_s <- I_s_dot(p0, b_a, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dTFN_a <- TFN_a_dot(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a)
    dTFN_s <- TFN_s_dot(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s)
    dTISO_ap <- TISO_ap_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap)
    dTISO_sp <- TISO_sp_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp)
    dTISO_an <- TISO_an_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an)
    dTISO_sn <- TISO_sn_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn)
    dRC <- RC_dot(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn)
    dRU <- RU_dot(gamma, I_a, I_s, TFN_a, TFN_s)
    return(list(c(dS, dI_a, dI_s, dTFN_a, dTFN_s, dTISO_an, dTISO_sn, dTISO_ap, dTISO_sp, dRC, dRU)))
  })
}

run_simulation <- function(state, testing, no_testing, semester) {
  states <- list()
  for (t in semester) {
    day <- seq(t - 1, t, by=1)
    if (t %% 7 == 0) {
      parameters <- testing
    } else {
      parameters <- no_testing
    }
    state <- ode(y = state, times = day, func = differentials, parms = parameters)[2,c(2:12)]
    states[[length(states) + 1]] <- state
  }
  return(states)
}
```

Now that the functions for solving the system have been defined, we run the simulation against all different testing scenarios, beginning with the baseline. The variables `baseline`, `PCR_100`, `PCR_50`, `PCR_33`, `RAP_100`, `RAP_50`, and `RAP_33` hold all state values for each day where `PCR` represents PCR testing and `RAP` represents Rapid Antigen Testing.

The scenarios for the simulations are as follows:

* Baseline: No testing
* $PCR_{100}$: PCR tests available to 100% of eligible student body per week
* $RA_{100}$: Rapid antigen tests available to 100% of the eligible student body per week
* $PCR_{50}$: PCR tests available to 50% of the eligible student body per week
* $RA_{50}$: Rapid antigen tests available to 50% of the eligible student body per week
* $PCR_{33}$: PCR tests available to 33% of the eligible student body per week
* $RA_{33}$: Rapid antigen tests available to 33% of the eligible student body per week

```{r}
# Baseline
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 100% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 1, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_100 <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 50% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0.5, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_50 <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 33% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0.33, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_33 <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 100% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 1, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_100 <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 50% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0.5, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_50 <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 33% of population
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0.33, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_33 <- run_simulation(initial_state, testing, no_testing, semester)
```

## Design Team Model Creation with Masking Compliance

The model created considers various states to describe a student's status as it relates to Covid-19 infection. The states are as follows:

$S$: susceptible

$I_a$: infected and asymptomatic

$I_s$: infected and symptomatic

$TFN_{a(s)}$: infected and asymptomatic (symptomatic), has been tested with false negative results

$TISO^+_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently in isolation

$TISO^-_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently not in isolation

$RC$: recovered and confirmed, i.e., has been diagnosed previously

$RU$: recovered and unknown, i.e., has not been diagnosed previously

The following equations describe the fraction of individuals in each state over time **while considering varying masking compliance situations**:

$$
\dot{S} = -\beta_a(1-MC)S(I_a + TFN_a + TISO_a^-)-\beta_s(1-MC)S(I_s+TFN_s+TISO_s^-)
$$

$$
\dot{I_a}= (1-p_0) \times [\beta_a(1-MC)S(I_a+TFN_a+TISO_a^-)+\beta_s(1-MC)S(I_s+TFN_s+TISO_s^-)]-T_{pcr} \times I_a-T{rap} \times I_a -\gamma_aI_a
$$

$$
\dot{I_s} = p_0 \times [\beta_a(1-MC)S(I_a+TFN_a+TISO_a^-)+\beta_s(1-MC)S(I_s+TFN_s+TISO_s^-)] − T_{pcr} × I_s − T_{rap} × I_s − γ_sI_s
$$

$$
\dot{TFN_a} =T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a − γ_a × TFN_a
$$

$$
\dot{TFN_s} =T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s − γ_s × TFN_s
$$

$$
\dot{TISO^+_a} =C_a × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^+_a
$$

$$
\dot{TISO^+_s} =C_s × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^+_s
$$

$$
\dot{TISO^−_a} =(1 − C_a) × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^−_a
$$

$$
\dot{TISO^−_s} =(1 − C_s) × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^−_s
$$

Below are the variable definitions

|          Parameter         |                                             Description                                             |           Value          |
|:--------------------------:|:---------------------------------------------------------------------------------------------------:|:------------------------:|
|     $\beta_a$,$\beta_s$    | Transmission rate due to contact between susceptible and asymptomatic/symptomatic infected subjects |          0.1,0.2         |
|          $\gamma$          |                              Rate of recovery of an infected individual                             |            0.1           |
|            $p_0$           |                            Proportion of infections that are symptomatic                            |            0.5           |
|         $C_a$,$C_s$        |        Isolation compliance rate for asymptomatic/symptomatic infected and tested individuals       |         0.7, 0.9         |
|  $FN_{pcr_a}$,$FN_{pcr_s}$ |               False negative rate of a PCR test for asymptomatic/symptomatic patients               |         15%, 15%         |
| $FN_{rap_a}$, $FN_{rap_s}$ |              False negative rate of a rapid test for asymptomatic/symptomatic patients              |         30%, 30%         |
| $FP_{pcr_a}$, $FP_{pcr_s}$ |               False positive rate of a PCR test for asymptomatic/symptomatic patients               |          5%, 5%          |
| $FP_{rap_a}$, $FP_{rap_s}$ |               False positive ate of a rapid test for asymptomatic/symptomatic patients              |         10%, 10%         |
|          $T_{pcr}$         |                         Percentage of students that have access to PCR tests                        | Defined in each scenario |
|  $T_{rap_a}$, $T_{rap_s}$  |                    Percentage of students that have access to rapid antigen tests                   | Defined in each scenario |
|          $MC$              |                    Level of mask compliance / mask mandate in school environment                    | Defined in each scenario |


Below is the R code for defining the initial values and constants of the system.

```{r}
# Initial states
b_a = 0.1       # transmission rate due to contact of asymptomatic patient
b_s = 0.2       # transmission rate due to contact of symptomatic patient
gamma = 0.1     # rate of recovery for an infected individual
p0 = 0.5        # proportion of infections that are symptomatic
c_a = 0.7       # isolation compliance asymptomatic infected + tested patients
c_s = 0.9       # isolation compliance symptomatic infected + tested patients
FNpcr_a = 0.15  # false negative rate of a PCR test for asymptomatic patients
FNpcr_s = 0.15  # false negative rate of a PCR test for symptomatic patients
FNrap_a = 0.30  # false negative rate of a rapid test for asymptomatic patients
FNrap_s = 0.30  # false negative rate of a rapid test for symptomatic patients
FPpcr_a = 0.05  # false positive rate of a PCR test for asymptomatic patients
FPpcr_s = 0.05  # false positive rate of a PCR test for symptomatic patients
FPrap_a = 0.10  # false positive rate of a rapid test for asymptomatic patients
FPrap_s = 0.10  # false positive rate of a rapid test for symptomatic patients

# Initial values
S_0 = 0.895     # initial susceptibility of the student body
I_s = 0.0025    # initial infected and symptomatic
I_a = 0.0025    # initial infected and asymptomatic
R_u = 0.10      # initial recovered unknown
R_c = 0.0       # initial recovered confirmed

# Initial test values (no tests administered)
TFN_a = 0       # initial population with a false negative and asymptomatic
TFN_s = 0       # initial population with a false negative and symptomatic 
TISO_an = 0     # initial population tested with infection, not in isolation, asymptomatic 
TISO_ap = 0     # initial population tested with infection, in isolation, asymptomatic 
TISO_sn = 0     # initial population tested with infection, not in isolation, symptomatic
TISO_sp = 0     # initial population tested with infection, in isolation, symptomatic

n = 15000       # student population

# Days in simulation
days <- 107

# Sequence for semester
semester <- seq(1, days, by=1)

# Initial state of the system
initial_state <- c(S_0 = S_0, I_a = I_a, I_s = I_s, TFN_a = TFN_a, TFN_s = TFN_s, TISO_an = TISO_an, TISO_sn = TISO_sn, TISO_ap = TISO_ap, TISO_sp = TISO_sp, RC = R_c, RU = R_u)
```

The following code defines the differential equations for the change in the states over time. The functions allow the user to input current values for the states and returns the derivative at that time step. 

```{r}
S_dot <- function(b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn) {
  result <- (-b_a * (1 - MC) * S_0 * (I_a + TFN_a + TISO_an)) - (b_s * (1 - MC) * S_0 * (I_s + TFN_s + TISO_sn))
  return(result)
}

I_a_dot <- function(p0, b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- (1 - p0) * ((b_a * (1 - MC) * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * (1 - MC) * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_a) - (T_rap * I_a) - (gamma * I_a)
  return(result)
}

I_s_dot <- function(p0, b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- p0 * ((b_a * (1 - MC) * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * (1 - MC) * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_s) - (T_rap * I_s) - (gamma * I_s)
  return(result)
}

TFN_a_dot <- function(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a) {
  result <- (T_pcr * FNpcr_a * I_a) + (T_rap * FNrap_a * I_a) - (gamma * TFN_a)
  return(result)
}

TFN_s_dot <- function(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s) {
  result <- (T_pcr * FNpcr_s * I_s) + (T_rap * FNrap_s * I_s) - (gamma * TFN_s)
  return(result)
}

TISO_ap_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap) {
  result <- c_a * ((T_pcr * (1 -FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_ap)
  return(result)
}

TISO_sp_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp) {
  result <- c_s * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sp)
  return(result)
}

TISO_an_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an) {
  result <- (1 - c_a) * ((T_pcr * (1 - FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_an)
  return(result)
}

TISO_sn_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn) {
  result <- (1 - c_s) * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sn)
  return(result)
}

RC_dot <- function(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn) {
  result <- gamma * (TISO_ap + TISO_sp + TISO_an + TISO_sn)
  return(result)
}

RU_dot <- function(gamma, I_a, I_s, TFN_a, TFN_s) {
  result <- gamma * (I_a + I_s + TFN_a + TFN_s)
  return(result)
}
```

Now that the system's equations have been defined, we define functions to observe the changes in the system. These functions include all of the state derivative equations as well as a function that loops through the days, solving the differential of all equations for each day of the semester. The function `run_simulation` takes 

* `state`: The initial state of the system,
* `testing`: The parameters for a day in which testing occurs
* `no_testing`: The parameters for a day in which no testing occurs
* `semester`: A time sequence representing the simulation semester

and returns a list containing the values of each state for each day. 

```{r, results='hide'}
library(deSolve)
library(scatterplot3d)
library(lubridate)
```

```{r}
# Define generic differential update function
differentials <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    dS <- S_dot(b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn)
    dI_a <- I_a_dot(p0, b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dI_s <- I_s_dot(p0, b_a, MC, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dTFN_a <- TFN_a_dot(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a)
    dTFN_s <- TFN_s_dot(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s)
    dTISO_ap <- TISO_ap_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap)
    dTISO_sp <- TISO_sp_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp)
    dTISO_an <- TISO_an_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an)
    dTISO_sn <- TISO_sn_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn)
    dRC <- RC_dot(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn)
    dRU <- RU_dot(gamma, I_a, I_s, TFN_a, TFN_s)
    return(list(c(dS, dI_a, dI_s, dTFN_a, dTFN_s, dTISO_an, dTISO_sn, dTISO_ap, dTISO_sp, dRC, dRU)))
  })
}

run_simulation <- function(state, testing, no_testing, semester) {
  states <- list()
  for (t in semester) {
    day <- seq(t - 1, t, by=1)
    if (t %% 7 == 0) {
      parameters <- testing
    } else {
      parameters <- no_testing
    }
    state <- ode(y = state, times = day, func = differentials, parms = parameters)[2,c(2:12)]
    states[[length(states) + 1]] <- state
  }
  return(states)
}
```



Now that the functions for solving the system have been defined, we run the simulation against all different testing scenarios, beginning with the baseline. The variables `baseline`, `baseline_varying`, `baseline_mandate`, `PCR_100`, `PCR_50`, `PCR_33`, `RAP_100`, `RAP_50`, and `RAP_33` hold all state values for each day where `PCR` represents PCR testing and `RAP` represents Rapid Antigen Testing.

The scenarios for the simulations are as follows:

* Baseline: No testing and no mask compliance
* Baseline_Varying: No testing and varying mask compliance
* Baseline_Mandate: No testing and 100% mask compliance

* $PCR_{100}^{none}$: PCR tests available to 100% of eligible student body per week, no mask compliance
* $PCR_{100}^{varying}$: PCR tests available to 100% of eligible student body per week, varying mask compliance
* $PCR_{100}^{mandate}$: PCR tests available to 100% of eligible student body per week, 100% mask compliance

* $RA_{100}^{none}$: Rapid antigen tests available to 100% of the eligible student body per week, no mask compliance
* $RA_{100}^{varying}$: Rapid antigen tests available to 100% of the eligible student body per week, varying mask compliance
* $RA_{100}^{mandate}$: Rapid antigen tests available to 100% of the eligible student body per week, 100% mask compliance

* $PCR_{50}^{none}$: PCR tests available to 50% of eligible student body per week, no mask compliance
* $PCR_{50}^{varying}$: PCR tests available to 50% of eligible student body per week, varying mask compliance
* $PCR_{50}^{mandate}$: PCR tests available to 50% of eligible student body per week, 100% mask compliance

* $RA_{50}^{none}$: Rapid antigen tests available to 50% of the eligible student body per week, no mask compliance
* $RA_{50}^{varying}$: Rapid antigen tests available to 50% of the eligible student body per week, varying mask compliance
* $RA_{50}^{mandate}$: Rapid antigen tests available to 50% of the eligible student body per week, 100% mask compliance

* $PCR_{33}^{none}$: PCR tests available to 33% of eligible student body per week, no mask compliance
* $PCR_{33}^{varying}$: PCR tests available to 33% of eligible student body per week, varying mask compliance
* $PCR_{33}^{mandate}$: PCR tests available to 33% of eligible student body per week, 100% mask compliance

* $RA_{33}^{none}$: Rapid antigen tests available to 33% of the eligible student body per week, no mask compliance
* $RA_{33}^{varying}$: Rapid antigen tests available to 33% of the eligible student body per week, varying mask compliance
* $RA_{33}^{mandate}$: Rapid antigen tests available to 33% of the eligible student body per week, 100% mask compliance



```{r}
# Baseline
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline <- run_simulation(initial_state, testing, no_testing, semester)
baseline

# Baseline and Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline_varying <- run_simulation(initial_state, testing, no_testing, semester)
baseline_varying

# Baseline and Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline_mandate <- run_simulation(initial_state, testing, no_testing, semester)
baseline_mandate

#########################################################

# PCR test available to 100% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 1, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_100_none <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 100% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 1, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_100_varying <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 100% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 1, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_100_mandate <- run_simulation(initial_state, testing, no_testing, semester)
PCR_100_mandate

#########################################################

# PCR test available to 50% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0.5, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_50_none <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 50% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0.5, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_50_varying <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 50% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0.5, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_50_mandate <- run_simulation(initial_state, testing, no_testing, semester)

#########################################################

# PCR test available to 33% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0.33, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_33_none <- run_simulation(initial_state, testing, no_testing, semester)

# PCR test available to 33% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0.33, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_33_varying <- run_simulation(initial_state, testing, no_testing, semester)
PCR_33_varying

# PCR test available to 33% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0.33, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
PCR_33_mandate <- run_simulation(initial_state, testing, no_testing, semester)
PCR_33_mandate

#########################################################

# Rapid test available to 100% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 1, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_100_none <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 100% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 1, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_100_varying <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 100% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 1, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_100_mandate <- run_simulation(initial_state, testing, no_testing, semester)

#########################################################

# Rapid test available to 50% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0.5, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_50_none <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 50% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0.5, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_50_varying <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 50% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0.5, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_50_mandate <- run_simulation(initial_state, testing, no_testing, semester)

#########################################################

# Rapid test available to 33% of population, No Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0.33, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_33_none <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 33% of population, Varying Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0.33, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_33_varying <- run_simulation(initial_state, testing, no_testing, semester)

# Rapid test available to 33% of population, 100% Mask Compliance
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0.33, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
RAP_33_mandate <- run_simulation(initial_state, testing, no_testing, semester)
RAP_33_mandate
```

## Design Team Model Creation with Masking Compliance and Vaccination Rates

The model created considers various states to describe a student's status as it relates to Covid-19 infection. The states are as follows:

$S$: susceptible

$I_a$: infected and asymptomatic

$I_s$: infected and symptomatic

$TFN_{a(s)}$: infected and asymptomatic (symptomatic), has been tested with false negative results

$TISO^+_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently in isolation

$TISO^-_{a(s)}$: infected and asymptomatic (symptomatic), has been tested and currently not in isolation

$RC$: recovered and confirmed, i.e., has been diagnosed previously

$RU$: recovered and unknown, i.e., has not been diagnosed previously

The following equations describe the fraction of individuals in each state over time **while considering varying masking compliance situations**:

$$
\dot{S} = -\beta_a(1-MC)(1-VR)S(I_a + TFN_a + TISO_a^-)-\beta_s(1-MC)(1-VR)S(I_s+TFN_s+TISO_s^-)
$$

$$
\dot{I_a}= (1-p_0) \times [\beta_a(1-MC)(1-VR)S(I_a+TFN_a+TISO_a^-)+\beta_s(1-MC)(1-VR)S(I_s+TFN_s+TISO_s^-)]-T_{pcr} \times I_a-T{rap} \times I_a -\gamma_aI_a
$$

$$
\dot{I_s} = p_0 \times [\beta_a(1-MC)(1-VR)S(I_a+TFN_a+TISO_a^-)+\beta_s(1-MC)(1-VR)S(I_s+TFN_s+TISO_s^-)] − T_{pcr} × I_s − T_{rap} × I_s − γ_sI_s
$$

$$
\dot{TFN_a} =T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a − γ_a × TFN_a
$$

$$
\dot{TFN_s} =T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s − γ_s × TFN_s
$$

$$
\dot{TISO^+_a} =C_a × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^+_a
$$

$$
\dot{TISO^+_s} =C_s × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^+_s
$$

$$
\dot{TISO^−_a} =(1 − C_a) × [T_{pcr} × FN_{pcr_a} × I_a + T_{rap} × FN_{rap_a} × I_a] − γ_a × TISO^−_a
$$

$$
\dot{TISO^−_s} =(1 − C_s) × [T_{pcr} × FN_{pcr_s} × I_s + T_{rap} × FN_{rap_s} × I_s] − γ_s × TISO^−_s
$$

Below are the variable definitions

|          Parameter         |                                             Description                                             |           Value          |
|:--------------------------:|:---------------------------------------------------------------------------------------------------:|:------------------------:|
|     $\beta_a$,$\beta_s$    | Transmission rate due to contact between susceptible and asymptomatic/symptomatic infected subjects |          0.1,0.2         |
|          $\gamma$          |                              Rate of recovery of an infected individual                             |            0.1           |
|            $p_0$           |                            Proportion of infections that are symptomatic                            |            0.5           |
|         $C_a$,$C_s$        |        Isolation compliance rate for asymptomatic/symptomatic infected and tested individuals       |         0.7, 0.9         |
|  $FN_{pcr_a}$,$FN_{pcr_s}$ |               False negative rate of a PCR test for asymptomatic/symptomatic patients               |         15%, 15%         |
| $FN_{rap_a}$, $FN_{rap_s}$ |              False negative rate of a rapid test for asymptomatic/symptomatic patients              |         30%, 30%         |
| $FP_{pcr_a}$, $FP_{pcr_s}$ |               False positive rate of a PCR test for asymptomatic/symptomatic patients               |          5%, 5%          |
| $FP_{rap_a}$, $FP_{rap_s}$ |               False positive ate of a rapid test for asymptomatic/symptomatic patients              |         10%, 10%         |
|          $T_{pcr}$         |                         Percentage of students that have access to PCR tests                        | Defined in each scenario |
|  $T_{rap_a}$, $T_{rap_s}$  |                    Percentage of students that have access to rapid antigen tests                   | Defined in each scenario |
|          $MC$              |                    Level of mask compliance / mask mandate in school environment                    | Defined in each scenario |
|          $VR$              |                    Vaccination Rate of students in school defined by school administrator           | Defined in each scenario |


Below is the R code for defining the initial values and constants of the system.

```{r}
# Initial states
b_a = 0.1       # transmission rate due to contact of asymptomatic patient
b_s = 0.2       # transmission rate due to contact of symptomatic patient
gamma = 0.1     # rate of recovery for an infected individual
p0 = 0.5        # proportion of infections that are symptomatic
c_a = 0.7       # isolation compliance asymptomatic infected + tested patients
c_s = 0.9       # isolation compliance symptomatic infected + tested patients
FNpcr_a = 0.15  # false negative rate of a PCR test for asymptomatic patients
FNpcr_s = 0.15  # false negative rate of a PCR test for symptomatic patients
FNrap_a = 0.30  # false negative rate of a rapid test for asymptomatic patients
FNrap_s = 0.30  # false negative rate of a rapid test for symptomatic patients
FPpcr_a = 0.05  # false positive rate of a PCR test for asymptomatic patients
FPpcr_s = 0.05  # false positive rate of a PCR test for symptomatic patients
FPrap_a = 0.10  # false positive rate of a rapid test for asymptomatic patients
FPrap_s = 0.10  # false positive rate of a rapid test for symptomatic patients

# Initial values
S_0 = 0.895     # initial susceptibility of the student body
I_s = 0.0025    # initial infected and symptomatic
I_a = 0.0025    # initial infected and asymptomatic
R_u = 0.10      # initial recovered unknown
R_c = 0.0       # initial recovered confirmed

# Initial test values (no tests administered)
TFN_a = 0       # initial population with a false negative and asymptomatic
TFN_s = 0       # initial population with a false negative and symptomatic 
TISO_an = 0     # initial population tested with infection, not in isolation, asymptomatic 
TISO_ap = 0     # initial population tested with infection, in isolation, asymptomatic 
TISO_sn = 0     # initial population tested with infection, not in isolation, symptomatic
TISO_sp = 0     # initial population tested with infection, in isolation, symptomatic

n = 15000       # student population

# Days in simulation
days <- 107

# Sequence for semester
semester <- seq(1, days, by=1)

# Initial state of the system
initial_state <- c(S_0 = S_0, I_a = I_a, I_s = I_s, TFN_a = TFN_a, TFN_s = TFN_s, TISO_an = TISO_an, TISO_sn = TISO_sn, TISO_ap = TISO_ap, TISO_sp = TISO_sp, RC = R_c, RU = R_u)
```

The following code defines the differential equations for the change in the states over time. The functions allow the user to input current values for the states and returns the derivative at that time step. 

```{r}
S_dot <- function(b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn) {
  result <- (-b_a * (1 - MC) * (1 - VR) * S_0 * (I_a + TFN_a + TISO_an)) - (b_s * (1 - MC) * (1 - VR) * S_0 * (I_s + TFN_s + TISO_sn))
  return(result)
}

I_a_dot <- function(p0, b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- (1 - p0) * ((b_a * (1 - MC) * (1 - VR) * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * (1 - MC) * (1 - VR) * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_a) - (T_rap * I_a) - (gamma * I_a)
  return(result)
}

I_s_dot <- function(p0, b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma) {
  result <- p0 * ((b_a * (1 - MC) * (1 - VR) * S_0 * (I_a + TFN_a + TISO_an)) + (b_s * (1 - MC) * (1 - VR) * S_0 * (I_s + TFN_s + TISO_sn))) - (T_pcr * I_s) - (T_rap * I_s) - (gamma * I_s)
  return(result)
}

TFN_a_dot <- function(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a) {
  result <- (T_pcr * FNpcr_a * I_a) + (T_rap * FNrap_a * I_a) - (gamma * TFN_a)
  return(result)
}

TFN_s_dot <- function(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s) {
  result <- (T_pcr * FNpcr_s * I_s) + (T_rap * FNrap_s * I_s) - (gamma * TFN_s)
  return(result)
}

TISO_ap_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap) {
  result <- c_a * ((T_pcr * (1 -FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_ap)
  return(result)
}

TISO_sp_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp) {
  result <- c_s * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sp)
  return(result)
}

TISO_an_dot <- function(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an) {
  result <- (1 - c_a) * ((T_pcr * (1 - FNpcr_a) * I_a) + (T_rap * (1 - FNrap_a) * I_a)) - (gamma * TISO_an)
  return(result)
}

TISO_sn_dot <- function(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn) {
  result <- (1 - c_s) * ((T_pcr * (1 - FNpcr_s) * I_s) + (T_rap * (1 - FNrap_s) * I_s)) - (gamma * TISO_sn)
  return(result)
}

RC_dot <- function(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn) {
  result <- gamma * (TISO_ap + TISO_sp + TISO_an + TISO_sn)
  return(result)
}

RU_dot <- function(gamma, I_a, I_s, TFN_a, TFN_s) {
  result <- gamma * (I_a + I_s + TFN_a + TFN_s)
  return(result)
}
```

Now that the system's equations have been defined, we define functions to observe the changes in the system. These functions include all of the state derivative equations as well as a function that loops through the days, solving the differential of all equations for each day of the semester. The function `run_simulation` takes 

* `state`: The initial state of the system,
* `testing`: The parameters for a day in which testing occurs
* `no_testing`: The parameters for a day in which no testing occurs
* `semester`: A time sequence representing the simulation semester

and returns a list containing the values of each state for each day. 

```{r, results='hide'}
library(deSolve)
library(scatterplot3d)
library(lubridate)
```

```{r}
# Define generic differential update function
differentials <- function(t, state, parameters) {
  with(as.list(c(state, parameters)), {
    dS <- S_dot(b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn)
    dI_a <- I_a_dot(p0, b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dI_s <- I_s_dot(p0, b_a, MC, VR, S_0, I_a, TFN_a, TISO_an, b_s, I_s, TFN_s, TISO_sn, T_pcr, T_rap, gamma)
    dTFN_a <- TFN_a_dot(T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TFN_a)
    dTFN_s <- TFN_s_dot(T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TFN_s)
    dTISO_ap <- TISO_ap_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_ap)
    dTISO_sp <- TISO_sp_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sp)
    dTISO_an <- TISO_an_dot(c_a, T_pcr, FNpcr_a, I_a, T_rap, FNrap_a, gamma, TISO_an)
    dTISO_sn <- TISO_sn_dot(c_s, T_pcr, FNpcr_s, I_s, T_rap, FNrap_s, gamma, TISO_sn)
    dRC <- RC_dot(gamma, TISO_ap, TISO_sp, TISO_an, TISO_sn)
    dRU <- RU_dot(gamma, I_a, I_s, TFN_a, TFN_s)
    return(list(c(dS, dI_a, dI_s, dTFN_a, dTFN_s, dTISO_an, dTISO_sn, dTISO_ap, dTISO_sp, dRC, dRU)))
  })
}

run_simulation <- function(state, testing, no_testing, semester) {
  states <- list()
  for (t in semester) {
    day <- seq(t - 1, t, by=1)
    if (t %% 7 == 0) {
      parameters <- testing
    } else {
      parameters <- no_testing
    }
    state <- ode(y = state, times = day, func = differentials, parms = parameters)[2,c(2:12)]
    states[[length(states) + 1]] <- state
  }
  return(states)
}
```



Now that the functions for solving the system have been defined, we run the simulation against all different testing scenarios, beginning with the baseline. The variables `baseline`, `baseline_varying`, `baseline_mandate`, `PCR_100`, `PCR_50`, `PCR_33`, `RAP_100`, `RAP_50`, and `RAP_33` hold all state values for each day where `PCR` represents PCR testing and `RAP` represents Rapid Antigen Testing.

The scenarios for the simulations are as follows:

* Baseline: No testing, no mask compliance, 0% vaccinated
* Baseline_Varying: No testing and varying mask compliance, 0% vaccinated
* Baseline_Mandate: No testing and 100% mask compliance, 0% vaccinated
* Baseline_Varying_Vaccinated: No testing and varying mask compliance, 50% vaccinated
* Baseline_Mandate_Vaccinated: No testing and 100% mask compliance, 50% vaccinated

\textcolor{red}{MODIFY THE FOLLOWING CASES}

* $PCR_{100}^{none}$: PCR tests available to 100% of eligible student body per week, no mask compliance
* $PCR_{100}^{varying}$: PCR tests available to 100% of eligible student body per week, varying mask compliance
* $PCR_{100}^{mandate}$: PCR tests available to 100% of eligible student body per week, 100% mask compliance

* $RA_{100}^{none}$: Rapid antigen tests available to 100% of the eligible student body per week, no mask compliance
* $RA_{100}^{varying}$: Rapid antigen tests available to 100% of the eligible student body per week, varying mask compliance
* $RA_{100}^{mandate}$: Rapid antigen tests available to 100% of the eligible student body per week, 100% mask compliance

* $PCR_{50}^{none}$: PCR tests available to 50% of eligible student body per week, no mask compliance
* $PCR_{50}^{varying}$: PCR tests available to 50% of eligible student body per week, varying mask compliance
* $PCR_{50}^{mandate}$: PCR tests available to 50% of eligible student body per week, 100% mask compliance

* $RA_{50}^{none}$: Rapid antigen tests available to 50% of the eligible student body per week, no mask compliance
* $RA_{50}^{varying}$: Rapid antigen tests available to 50% of the eligible student body per week, varying mask compliance
* $RA_{50}^{mandate}$: Rapid antigen tests available to 50% of the eligible student body per week, 100% mask compliance

* $PCR_{33}^{none}$: PCR tests available to 33% of eligible student body per week, no mask compliance
* $PCR_{33}^{varying}$: PCR tests available to 33% of eligible student body per week, varying mask compliance
* $PCR_{33}^{mandate}$: PCR tests available to 33% of eligible student body per week, 100% mask compliance

* $RA_{33}^{none}$: Rapid antigen tests available to 33% of the eligible student body per week, no mask compliance
* $RA_{33}^{varying}$: Rapid antigen tests available to 33% of the eligible student body per week, varying mask compliance
* $RA_{33}^{mandate}$: Rapid antigen tests available to 33% of the eligible student body per week, 100% mask compliance



```{r}

masking_compliance <- readline(prompt = "What is your school's policy on masking? ")
masking_compliance <- as.integer(masking_compliance)



if (masking_compliance == "None") {
  testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  baseline <- run_simulation(initial_state, testing, no_testing, semester)
  print(baseline)
} else if (masking_compliance == "Varying") {
  testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  baseline <- run_simulation(initial_state, testing, no_testing, semester)
  print(baseline)
} else {
  testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
  baseline <- run_simulation(initial_state, testing, no_testing, semester)
  print(baseline)
}

# Baseline
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0, VR = 0, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline <- run_simulation(initial_state, testing, no_testing, semester)
baseline

# Baseline, Varying Mask Compliance, 50% Vaccinated
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, VR = 0.5, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.03, VR = 0.5, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline_varying_vaccinated <- run_simulation(initial_state, testing, no_testing, semester)
baseline_varying_vaccinated

# Baseline, 100% Mask Compliance, 50% Vaccinated
testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, VR = 0.5, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
no_testing <- c(b_a = b_a, b_s = b_s, p0 = p0, c_a = c_a, c_s = c_s, MC = 0.1, VR = 0.5, T_pcr = 0, T_rap = 0, gamma = gamma, FNpcr_a = FNpcr_a, FNpcr_s = FNpcr_s, FNrap_a = FNrap_a, FNrap_s = FNrap_s)
baseline_mandate_vaccinated <- run_simulation(initial_state, testing, no_testing, semester)
baseline_mandate_vaccinated
```